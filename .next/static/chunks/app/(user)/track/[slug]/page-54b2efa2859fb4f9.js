(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[507],{25087:function(e,t,n){Promise.resolve().then(n.t.bind(n,78139,23)),Promise.resolve().then(n.bind(n,45076)),Promise.resolve().then(n.bind(n,78614)),Promise.resolve().then(n.t.bind(n,46685,23)),Promise.resolve().then(n.bind(n,46986)),Promise.resolve().then(n.bind(n,49605)),Promise.resolve().then(n.bind(n,67722)),Promise.resolve().then(n.bind(n,81774)),Promise.resolve().then(n.bind(n,84434))},84434:function(e,t,n){"use strict";n.r(t);var r=n(57437),o=n(39227),i=n(21975),s=n(3283),a=n(43226),l=n(35551),d=n(38247),u=n(2265),c=n(81835),h=n(24033),v=n(98321),f=n(98707);t.default=e=>{let{comment:t,token:n,songID:x}=e,g=(0,h.useRouter)(),[p,m]=(0,u.useState)(""),{wavesurferRef:y}=(0,v.useWaveSurfer)(),j=async()=>{try{var e;(null==y?void 0:y.current)&&(await (0,c.w)({url:"".concat("http://160.25.81.159:8000/api/v1","/comments"),method:"POST",headers:{Authorization:"Bearer ".concat(n)},body:{songID:x,content:p,ghimSecond:Math.round(null==y?void 0:null===(e=y.current)||void 0===e?void 0:e.getCurrentTime())}}),m(""),g.refresh())}catch(e){console.error(e)}},C=e=>{let t=y.current;if(t){let n=t.getDuration();n>0&&(t.seekTo(e/n),t.play())}};return(0,r.jsxs)(o.Z,{sx:{mr:4},children:[(0,r.jsx)(i.Z,{fullWidth:!0,label:"B\xecnh luận...",value:p,variant:"standard",sx:{mb:3},onChange:e=>m(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),j())}}),t.map(e=>{var t;return(0,r.jsxs)(o.Z,{display:"flex",gap:2,py:2,borderBottom:"1px solid #eee",children:[(0,r.jsx)(s.Z,{src:"".concat("http://160.25.81.159:8000","/image/user/").concat(e.userID.avatar),sx:{width:40,height:40}}),(0,r.jsxs)(o.Z,{flex:1,children:[(0,r.jsxs)(o.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(a.Z,{fontWeight:"bold",children:null===(t=e.userID)||void 0===t?void 0:t.name}),(0,r.jsxs)(a.Z,{variant:"caption",color:"text.secondary",onClick:()=>C(e.ghimSecond),sx:{cursor:"pointer"},children:[e.ghimSecond,"s"]})]}),(0,r.jsx)(a.Z,{variant:"caption",color:"text.secondary",children:(0,f.Z)(e.createdAt).fromNow()})]}),(0,r.jsx)(a.Z,{sx:{mt:.5,mb:1},children:e.content}),(0,r.jsx)(o.Z,{display:"flex",alignItems:"center",gap:2,children:(0,r.jsx)(l.Z,{startIcon:(0,r.jsx)(d.Z,{fontSize:"small"}),size:"small",sx:{textTransform:"none"},children:"Phản hồi"})})]})]},e._id)})]})}},98707:function(e,t,n){"use strict";n.d(t,{o:function(){return a}});var r=n(74548),o=n.n(r),i=n(6537),s=n.n(i);n(93358),o().extend(s()),o().locale("vi");let a=e=>{let t=o()(),n=o()(e);return 1>t.diff(n,"minute")?"now":1>t.diff(n,"hour")||1>t.diff(n,"day")?n.format("hh:mm A"):1>t.diff(n,"year")?n.format("MMM DD hh:mm A"):n.format("DDD MM YYYY hh:mm A")};t.Z=o()},24197:function(e,t,n){"use strict";n.d(t,{F:function(){return a}});var r=n(57437),o=n(53975),i=n(49804),s=n(2265);let a=e=>{let{message:t,onExited:n,autoHideDuration:a,...l}=e,[d,u]=s.useState(!0);return(0,r.jsx)(o.Z,{open:d,onClose:(e,t)=>{"clickaway"!==t&&u(!1)},TransitionProps:{onExited:n},anchorOrigin:{vertical:"top",horizontal:"right"},autoHideDuration:null!=a?a:3e3,...l,children:(0,r.jsx)(i.Z,{severity:t.severity,children:t.message})},t.key)}},27392:function(e,t,n){"use strict";n.d(t,{pm:function(){return r.useToast}}),n(24197);var r=n(73534)},73534:function(e,t,n){"use strict";n.r(t),n.d(t,{ToastContext:function(){return s},ToastProvider:function(){return a},useToast:function(){return l}});var r=n(57437),o=n(2265),i=n(24197);let s=(0,o.createContext)(null),a=e=>{let{children:t,...n}=e,[a,l]=(0,o.useState)([]),d=e=>l(t=>t.filter(t=>t.key!==e));return(0,r.jsxs)(s.Provider,{value:{addMessage(e){l(t=>[...t,e])}},children:[t,a.map(e=>(0,r.jsx)(i.F,{message:e,onExited:()=>d(e.key),...n},e.key))]})},l=()=>{let{addMessage:e}=(0,o.useContext)(s),t=(t,n)=>{e({message:t,...n,key:new Date().getTime()})};return{show:t,info(e){t(e,{severity:"info"})},success(e){t(e,{severity:"success"})},warning(e){t(e,{severity:"warning"})},error(e){t(e,{severity:"error"})}}}},81774:function(e,t,n){"use strict";n.r(t);var r=n(57437),o=n(81835),i=n(46986),s=n(7216),a=n(67722),l=n(20020),d=n(49605),u=n(39227),c=n(90858),h=n(52653),v=n(2265),f=n(94758);t.default=e=>{var t,n,x;let{song:g,session:p}=e,[m,y]=(0,v.useState)((null==g?void 0:null===(t=g.like)||void 0===t?void 0:t.length)||0),[j,C]=(0,v.useState)((null==g?void 0:null===(n=g.dislike)||void 0===n?void 0:n.length)||0),[S,b]=(0,v.useState)((null==g?void 0:null===(x=g.totalListen)||void 0===x?void 0:x.length)||0),[w,k]=(0,v.useState)(!1),[Z,D]=(0,v.useState)(!1);(0,v.useEffect)(()=>{var e,t;if(!p)return;let n=p._id;(null==g?void 0:null===(e=g.like)||void 0===e?void 0:e.includes(n))&&k(!0),(null==g?void 0:null===(t=g.dislike)||void 0===t?void 0:t.includes(n))&&D(!0)},[p,g]);let _=async()=>{try{var e;let t=await (0,o.w)({url:"".concat("http://160.25.81.159:8000/api/v1","/songs/like/").concat(null==g?void 0:g._id),method:"PATCH",headers:{Authorization:"Bearer ".concat(p.access_token)}});Z&&C(j-1),(null==t?void 0:t.data)&&(y((null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.length)||0),k(!0),D(!1))}catch(e){console.error("Lỗi khi like b\xe0i h\xe1t",e)}},P=async()=>{try{var e;let t=await (0,o.w)({url:"".concat("http://160.25.81.159:8000/api/v1","/songs/dislike/").concat(null==g?void 0:g._id),method:"PATCH",headers:{Authorization:"Bearer ".concat(p.access_token)}});w&&y(m-1),(null==t?void 0:t.data)&&(C((null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.length)||0),D(!0),k(!1))}catch(e){console.error("Lỗi khi dislike b\xe0i h\xe1t",e)}};return(0,r.jsxs)(u.Z,{sx:{display:"flex",gap:4,mt:2},children:[(0,r.jsxs)(u.Z,{sx:{display:"flex",alignItems:"center",gap:1,cursor:"pointer"},children:[w?(0,r.jsx)(s.Z,{fontSize:"small",sx:{color:"red"},onClick:_}):(0,r.jsx)(i.default,{fontSize:"small",onClick:_}),(0,r.jsx)("span",{children:m})]}),(0,r.jsxs)(u.Z,{sx:{display:"flex",alignItems:"center",gap:1,cursor:"pointer"},children:[Z?(0,r.jsx)(l.Z,{fontSize:"small",sx:{color:"blue"},onClick:P}):(0,r.jsx)(a.default,{fontSize:"small",onClick:P}),(0,r.jsx)("span",{children:j})]}),(0,r.jsxs)(u.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(d.default,{fontSize:"small"}),(0,r.jsx)("span",{children:S})]}),(0,r.jsx)(c.Z,{title:"Th\xeam v\xe0o danh s\xe1ch ph\xe1t",children:(0,r.jsx)(h.Z,{sx:{"&:hover":{background:"white"}},size:"small",children:(0,r.jsx)(f.Z,{fontSize:"small"})})})]})}},45076:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return C}});var r=n(57437),o=n(39227),i=n(52653),s=n(90858),a=n(2265),l=n(92385),d=n(98507),u=n(82749),c=n(64072),h=n(98321),v=n(50711),f=n(61396),x=n.n(f),g=n(81835),p=n(24033);let m={_id:"",name:"",users:[{_id:"",name:""}],audio:"",cover:"",genres:[],totalListen:[{_id:"",date:new Date}],like:[],dislike:[],isDeleted:!1,deletedAt:null,isVip:!1,createBy:{_id:"",name:"",avatar:"",following:[],followers:[]},createdAt:new Date,updatedAt:new Date,state:""};var y=n(27392),j=n(81735),C=e=>{var t,n,f,C,S;let b=(0,a.useRef)(null),w=(0,a.useRef)(null),k=(0,a.useRef)(null),Z=(0,a.useRef)(null),[D,_]=(0,a.useState)(!1),[P,I]=(0,a.useState)(!1),{wavesurferRef:B}=(0,h.useWaveSurfer)(),{currentSong:z,setCurrentSong:T}=(0,v.useSongContext)(),{data:A}=(0,u.useSession)(),E=(0,a.useRef)(!1),R=(0,p.useRouter)(),L=(0,y.pm)();(0,a.useEffect)(()=>{if(!b.current)return;let t=document.createElement("canvas"),n=t.getContext("2d"),r=1*t.height,o=n.createLinearGradient(0,0,0,r);o.addColorStop(0,"#656666"),o.addColorStop(.7,"#656666"),o.addColorStop(.701,"#ffffff"),o.addColorStop(.702,"#ffffff"),o.addColorStop(.703,"#B1B1B1"),o.addColorStop(1,"#B1B1B1");let i=n.createLinearGradient(0,0,0,r);i.addColorStop(0,"#EE772F"),i.addColorStop(.7,"#EB4926"),i.addColorStop(.701,"#ffffff"),i.addColorStop(.702,"#ffffff"),i.addColorStop(.703,"#F6B094"),i.addColorStop(1,"#F6B094");let s=l.Z.create({container:b.current,waveColor:o,progressColor:i,barWidth:2,url:"/api?audio=".concat(e.audio)});B.current=s,T({...e.song,isPlayCurrent:!1,duration:s.getDuration(),current:0,totalListen:e.song.totalListen});let a=s.on("interaction",()=>s.playPause()),d=s.on("decode",e=>{Z.current&&(Z.current.textContent=W(e))}),u=s.on("ready",()=>{_(!0),Z.current&&(Z.current.textContent=W(s.getDuration())),E.current=!1}),c=s.on("timeupdate",t=>{k.current&&(k.current.textContent=W(t)),T(n=>({...e.song,isPlayCurrent:s.isPlaying(),duration:s.getDuration(),current:t}))}),h=s.on("pause",()=>{E.current=!1,I(!1),T(t=>({...e.song,isPlayCurrent:!1,duration:s.getDuration(),current:s.getCurrentTime()}))}),v=s.on("play",()=>{var t;(null===(t=e.song)||void 0===t?void 0:t.isVip)&&(null==A?void 0:A.user)&&!(0,j.IS)({user:e.song.users,role:A.user.role,propUserID:A.user._id,songID:e.song._id,shared:A.user.shared})&&(L.error("B\xe0i h\xe1t n\xe0y chỉ d\xe0nh cho người d\xf9ng VIP"),s.pause())}),f=s.on("finish",async()=>{E.current=!1,I(!1),T(e=>({init:m,isPlayCurrent:!1,duration:0,current:0}));try{var e,t;let n=await (0,g.w)({url:"".concat("http://160.25.81.159:8000/api/v1","/playlists?limit=1"),method:"GET",headers:{Authorization:"Bearer ".concat(null==A?void 0:null===(e=A.user)||void 0===e?void 0:e.access_token)}});if(null==n?void 0:n.data){let e=null==n?void 0:n.data;(0,g.w)({url:"".concat("http://160.25.81.159:8000/api/v1","/playlists/delete/").concat(e[0].songID[0]._id),method:"DELETE",headers:{Authorization:"Bearer ".concat(null==A?void 0:null===(t=A.user)||void 0===t?void 0:t.access_token)}}),R.push("/track/".concat(e[0].songID[0]._id,"?audio=").concat(e[0].songID[0].audio,"&id=").concat(e[0].songID[0]._id))}}catch(e){console.log(e)}});return T({...e.song,isPlayCurrent:!1,duration:s.getDuration(),current:0}),()=>{a(),d(),u(),c(),h(),f(),v(),s.destroy()}},[e.audio,T,B]);let W=e=>"".concat(Math.floor(e/60),":").concat((Math.round(e)%60).toString().padStart(2,"0")),M=(0,a.useCallback)(()=>{let t=B.current;if(!t)return;let n=!t.isPlaying();n?t.play():t.pause(),I(n),T({...e.song,isPlayCurrent:n,duration:t.getDuration(),current:t.getCurrentTime()})},[e.song,T,B]),F=(0,a.useCallback)(async()=>{var t;if(null==A?void 0:A.user)try{await (0,g.w)({url:"".concat("http://160.25.81.159:8000/api/v1","/historys"),method:"POST",headers:{Authorization:"Bearer ".concat(A.user.access_token)},body:{songID:e.song._id,start:null===(t=B.current)||void 0===t?void 0:t.getCurrentTime()}})}catch(e){console.error(e)}},[B,e.song]);(0,a.useEffect)(()=>{var t,n;if((null==A?void 0:A.user)&&(null===(n=e.song)||void 0===n?void 0:null===(t=n.totalListen)||void 0===t?void 0:t.some(e=>e._id===A.user._id)))return;let r=B.current;if(!r||!A)return;let o=async t=>{let n=r.getDuration();if(n>0&&t/n>=.1&&!E.current)try{let t=await (0,g.w)({url:"".concat("http://160.25.81.159:8000/api/v1","/songs/updateview/").concat(e.song._id),method:"PATCH",headers:{Authorization:"Bearer ".concat(A.user.access_token)}});200===t.statusCode&&T(e=>({...e,totalListen:t.data})),E.current=!0,console.log("Đ\xe3 gửi y\xeau cầu cập nhật lượt xem cho b\xe0i h\xe1t ".concat(e.song.name)),R.refresh()}catch(e){console.error(e)}},i=r.on("timeupdate",o);return()=>{i()}},[e.song._id,A,B]);let H=e=>{var t;if(B.current)return e/(null===(t=B.current)||void 0===t?void 0:t.getDuration())*100};return(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsxs)(o.Z,{sx:{flex:7,position:"relative",cursor:"pointer","& #hover":{position:"absolute",left:0,top:0,zIndex:10,pointerEvents:"none",height:"100%",width:0,mixBlendMode:"overlay",background:"rgba(255, 255, 255, 0.5)",opacity:0,transition:"opacity 0.2s ease"},"& #time, & #duration":{position:"absolute",zIndex:11,top:"50%",transform:"translateY(-50%)",fontSize:"11px",background:"rgba(0, 0, 0, 0.75)",color:"#ddd"},"& #time":{left:0},"& #duration":{right:0}},onPointerMove:e=>{if(w.current&&b.current){let t=b.current.getBoundingClientRect(),n=e.clientX-t.left;w.current.style.width="".concat(n,"px"),w.current.style.opacity="1"}},onPointerLeave:()=>{w.current&&(w.current.style.opacity="0")},children:[(0,r.jsxs)(o.Z,{sx:{display:"flex",alignContent:"space-around"},children:[(0,r.jsx)(i.Z,{disabled:e.song.isVip&&(null==A?void 0:A.user)&&!(0,j.IS)({user:e.song.users,role:A.user.role,propUserID:A.user._id,songID:e.song._id,shared:null==A?void 0:null===(t=A.user)||void 0===t?void 0:t.shared}),onClick:()=>{M(),F()},sx:{backgroundColor:"#fff",width:50,height:50,borderRadius:"50%",marginRight:2,"&:hover":{backgroundColor:"#f50",color:"#fff"}},children:P?(0,r.jsx)(c.Z,{sx:{fontSize:30}}):(0,r.jsx)(d.Z,{sx:{fontSize:30}})}),(0,r.jsxs)(o.Z,{children:[(0,r.jsx)("h3",{style:{color:"#fff",margin:0},children:null==e?void 0:null===(n=e.song)||void 0===n?void 0:n.name}),(0,r.jsx)(o.Z,{sx:{a:{textDecoration:"unset",color:"#aaa",fontSize:12}},children:null==e?void 0:null===(f=e.song)||void 0===f?void 0:f.users.map(e=>(0,r.jsxs)(x(),{href:"/detail/".concat(e._id),children:[e.name," "]}))})]})]}),(0,r.jsx)("div",{id:"time",ref:k,children:"0:00"}),(0,r.jsx)("div",{id:"duration",ref:Z,children:"0:00"}),(0,r.jsx)("div",{id:"hover",ref:w}),(0,r.jsx)("div",{id:"waveform",ref:b,children:D&&(null==e?void 0:null===(C=e.comment)||void 0===C?void 0:C.map((e,t)=>(0,r.jsx)(s.Z,{title:"".concat(e.content," ở ").concat(e.ghimSecond,"s"),arrow:!0,children:(0,r.jsx)("img",{src:"".concat("http://160.25.81.159:8000","/image/user/").concat(e.userID.avatar),style:{position:"absolute",bottom:0,height:30,width:30,borderRadius:"50%",left:"".concat(H(e.ghimSecond),"%"),zIndex:9,border:"2px solid white"},alt:"comment-avatar"},t)},t)))})]}),(0,r.jsx)(o.Z,{sx:{flex:3,width:150,height:300,borderRadius:2,overflow:"hidden"},children:(0,r.jsx)("img",{src:"".concat("http://160.25.81.159:8000","/image/song/").concat(null==e?void 0:null===(S=e.song)||void 0===S?void 0:S.cover),alt:"cover",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}},50711:function(e,t,n){"use strict";n.r(t),n.d(t,{SongProvider:function(){return s},useSongContext:function(){return a}});var r=n(57437),o=n(2265);let i=(0,o.createContext)(null),s=e=>{let{children:t}=e,[n,s]=(0,o.useState)(null);return(0,r.jsx)(i.Provider,{value:{currentSong:n,setCurrentSong:s},children:t})},a=()=>{let e=(0,o.useContext)(i);if(!e)throw Error("useSongContext must be used within a SongProvider");return e}},98321:function(e,t,n){"use strict";n.r(t),n.d(t,{WaveSurferProvider:function(){return s},useWaveSurfer:function(){return a}});var r=n(57437),o=n(2265);let i=(0,o.createContext)(null),s=e=>{let{children:t}=e,n=(0,o.useRef)(null);return(0,r.jsx)(i.Provider,{value:{wavesurferRef:n},children:t})},a=()=>{let e=(0,o.useContext)(i);if(!e)throw Error("useWaveSurfer must be used within WaveSurferProvider");return e}},78614:function(e,t,n){"use strict";n.r(t);var r=n(57437),o=n(39227),i=n(3283),s=n(43226),a=n(35551),l=n(43881),d=n(2265),u=n(81835),c=n(61396),h=n.n(c);t.default=e=>{var t,n,c;let{song:v,session:f}=e,[x,g]=(0,d.useState)((null==v?void 0:null===(n=v.createBy)||void 0===n?void 0:null===(t=n.followers)||void 0===t?void 0:t.length)||0),[p,m]=(0,d.useState)(!1),y=async()=>{try{var e,t;let n=await (0,u.w)({url:"".concat("http://160.25.81.159:8000/api/v1","/users/follower/").concat(null==v?void 0:null===(e=v.createBy)||void 0===e?void 0:e._id),method:"PATCH",headers:{Authorization:"Bearer ".concat(f.access_token)}});(null==n?void 0:n.data)&&(g(null==n?void 0:null===(t=n.data)||void 0===t?void 0:t.length),m(!0))}catch(e){}};return(0,d.useEffect)(()=>{var e;f&&(null==v?void 0:null===(e=v.createBy)||void 0===e?void 0:e.followers.includes(f._id))&&m(!0)},[f,v]),(0,r.jsxs)(o.Z,{sx:{width:200,borderRadius:2,padding:2,textAlign:"center",mt:5,border:"2px dashed"},children:[(0,r.jsx)(i.Z,{src:"".concat("http://160.25.81.159:8000","/image/user/").concat(null==v?void 0:v.createBy.avatar),sx:{width:80,height:80,margin:"auto",mb:1}}),(0,r.jsx)(o.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:1},children:(0,r.jsx)(s.Z,{fontWeight:"bold",noWrap:!0,children:null==v?void 0:v.createBy.name})}),(0,r.jsxs)(o.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:1,mt:.5},children:[(0,r.jsx)(h(),{href:"/detail/".concat(null==v?void 0:null===(c=v.createBy)||void 0===c?void 0:c._id),children:(0,r.jsx)(l.Z,{sx:{fontSize:16}})}),(0,r.jsx)(s.Z,{variant:"body2",children:x})]}),(0,r.jsx)(a.Z,{variant:"contained",fullWidth:!0,sx:{mt:2,backgroundColor:"#333",textTransform:"none","&:hover":{backgroundColor:"#555"}},onClick:()=>y(),children:p?"Đang Theo d\xf5i":"Theo d\xf5i"})]})}},81835:function(e,t,n){"use strict";n.d(t,{w:function(){return r}});let r=async e=>{let{url:t,method:n,body:r,useCredentials:o=!1,headers:i={},nextOption:s={}}=e,a={method:n,headers:new Headers({"content-type":"application/json",...i}),body:r?JSON.stringify(r):null,...s};return o&&(a.credentials="include"),fetch(t,a).then(e=>e.ok?e.json():e.json().then(function(t){var n,r;return{statusCode:e.status,message:null!==(n=null==t?void 0:t.message)&&void 0!==n?n:"",error:null!==(r=null==t?void 0:t.error)&&void 0!==r?r:""}}))}},81735:function(e,t,n){"use strict";n.d(t,{IS:function(){return s},Zd:function(){return r}});let r=e=>e.some(e=>"687bc3702806ef7792a8eba2"===e||"687e71714a591f0af8895298"===e||"687e71794a591f0af889529e"===e),o=e=>e.user.some(t=>t._id===e.propUserID),i=e=>{let{songID:t,shared:n}=e;return null==n?void 0:n.some(e=>e===t)},s=e=>{let{user:t,role:n,propUserID:s,songID:a,shared:l}=e,d=o({user:t,propUserID:s}),u=r(n),c=i({songID:a,shared:l});return!!d||!!u||!!c}}},function(e){e.O(0,[0,52,256,709,139,690,61,305,975,858,342,998,971,596,744],function(){return e(e.s=25087)}),_N_E=e.O()}]);